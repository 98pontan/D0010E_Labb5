package lab5.events;
import lab5.sim.*;
import lab5.store.*;

/**
 * Description
 * 
 * @author Lucas Pettersson,
 * @author Pontus Eriksson Jirbratt, 
 * @author Jesper Johansson Oskarsson, 
 * @author Markus Blomqvist
 *
 */
public class ArrivalEvent extends Event {
	
	private GatherEvent gatherEvent;
	private ArrivalEvent arrivalEvent;

	public ArrivalEvent(SimState state, EventQueue eventQueue, double time) 
	{
		super(state, eventQueue);
		this.time = time;
		this.name = "Arrival";
	}

	/**
	 * execution of arrival event
	 * if the store is closed, the customer will be turned away and missed customers will increase by one.
	 * else an arrival event is created
	 * if the store is open and not full, a new customer will be created
	 * else increase missed customers by one
	 */
	public void run() 
	{
		StoreState model = (StoreState) this.state;

		// TODO: Make it pretty? Switch maybe?
		if (!model.isOpen()) {
			model.turnedAwayCustomer();
			return;
		}

		else {
			double arrivalTime = model.getTimeFactory().generateArrivalTime();
			arrivalEvent = new ArrivalEvent(model, this.eventQueue, arrivalTime);
			eventQueue.addEvent(arrivalEvent);
			return;
		}

		if (model.isOpen() && !model.isFull()) {
			customer = model.createCustomer(CustomerState.IN_STORE);
			model.addCustomer(customer);
			
			double gatherTime = model.getTimeFactory().generateGatherTime();
			
	    	gatherEvent = new GatherEvent(model, this.eventQueue, customer, gatherTime);
			eventQueue.addEvent(gatherEvent);
		}

		else {
			model.missedCustomers();
		}
		
		updateTime(model);
		state.update(this);
	}
}